<!doctype html>
<head>
  <meta charset="utf-8">
  <title>New Angular Router</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="style.css" rel="stylesheet">
  <link href="highlight.css" rel="stylesheet">
</head>
<body lang="en">
  
<h1>Component Lifecycle Hooks</h1><p>There are four main lifecycle hooks: <a href="#can-activate"><code>canActivate</code></a>, <a href="#activate"><code>activate</code></a>, and <a href="#can-deactivate"><code>canDeactivate</code></a>, and <a href="#deactivate"><code>deactivate</code></a>.</p>
<p>A component can make use of these hooks by implementing any of them.</p>
<p>To understand how this works, let&#39;s step through a simple case where a component wants to navigate from one route to another.</p>
<!--
TODO: expected behavior of a navigation while another navigation is completing?
-->

<h2 id="can-activate"><a class="anchor" href="#can-activate"><span class="header-link"></span></a>canActivate</h2><p>Before switching to a new component, this hook runs for each active component in the app.
If any of them return <code>false</code>, a rejected promise, or a promise that resolves to <code>false</code>,
the navigation is cancelled.</p>
<p>This hook is useful for authentication.</p>
<h3 id="-example"><a class="anchor" href="#-example"><span class="header-link"></span></a>Example</h3><pre><code class="lang-js"><span class="identifier">angular</span>.<span class="identifier">module</span>(<span class="string">'app'</span>, [])
  .<span class="identifier">controller</span>(<span class="string">'MyController'</span>, [<span class="string">'user'</span>, <span class="string">'$http'</span>, <span class="identifier">MyController</span>]);

<span class="keyword">function</span> <span class="identifier">MyController</span>(<span class="param">user</span>, <span class="param">$http</span>) {
  <span class="control-flow">this</span>.<span class="identifier">user</span> <span class="operator">=</span> <span class="identifier">user</span>;
  <span class="control-flow">this</span>.<span class="identifier">$http</span> <span class="operator">=</span> <span class="identifier">$http</span>;
}

<span class="identifier">MyController</span>.<span class="identifier">prototype</span>.<span class="identifier">canActivate</span> <span class="operator">=</span> <span class="keyword">function</span>() {
  <span class="control-flow">return</span> <span class="control-flow">this</span>.<span class="identifier">user</span>.<span class="identifier">isAdmin</span>;
};
</code></pre>
<h2 id="activate"><a class="anchor" href="#activate"><span class="header-link"></span></a>activate</h2><p>This hook fires just before the nagivation finishes.</p>
<p>This hook is useful for cases where you want your component to do some intensive work.</p>
<h3 id="-example"><a class="anchor" href="#-example"><span class="header-link"></span></a>Example</h3><pre><code class="lang-js"><span class="identifier">angular</span>.<span class="identifier">module</span>(<span class="string">'app'</span>, [])
  .<span class="identifier">controller</span>(<span class="string">'MyController'</span>, [<span class="string">'user'</span>, <span class="string">'$http'</span>, <span class="identifier">MyController</span>]);

<span class="keyword">function</span> <span class="identifier">MyController</span>(<span class="param">user</span>, <span class="param">$http</span>) {
  <span class="control-flow">this</span>.<span class="identifier">user</span> <span class="operator">=</span> <span class="identifier">user</span>;
  <span class="control-flow">this</span>.<span class="identifier">$http</span> <span class="operator">=</span> <span class="identifier">$http</span>;
}

<span class="identifier">MyController</span>.<span class="identifier">prototype</span>.<span class="identifier">canActivate</span> <span class="operator">=</span> <span class="keyword">function</span>() {
  <span class="control-flow">return</span> <span class="control-flow">this</span>.<span class="identifier">user</span>.<span class="identifier">isAdmin</span>;
};

<span class="identifier">MyController</span>.<span class="identifier">prototype</span>.<span class="identifier">activate</span> <span class="operator">=</span> <span class="keyword">function</span>() {
  <span class="control-flow">return</span> <span class="control-flow">this</span>.<span class="identifier">bigFiles</span> <span class="operator">=</span> <span class="control-flow">this</span>.<span class="identifier">$http</span>.<span class="identifier">downloadBigFiles</span>();
};
</code></pre>
<h2 id="can-deactivate"><a class="anchor" href="#can-deactivate"><span class="header-link"></span></a>canDeactivate</h2><p>This hook fires for each component that is removed as part of navigation.
<code>canDeactivate</code> fires before any new components are instantiated.
If any of them return <code>false</code>, a rejected promise, or a promise that resolves to <code>false</code>,
the navigation is cancelled.</p>
<p><code>canDeactivate</code> is useful for making sure that data is properly persisted before navigating away.</p>
<h3 id="-example"><a class="anchor" href="#-example"><span class="header-link"></span></a>Example</h3><p>In this example, we show a dialog asking a user whether or not to save their work
before continuing.</p>
<pre><code class="lang-js"><span class="identifier">angular</span>.<span class="identifier">module</span>(<span class="string">'app.save'</span>, [])
  .<span class="identifier">controller</span>(<span class="string">'SaveController'</span>, [<span class="string">'$q'</span>, <span class="identifier">SaveController</span>]);

<span class="keyword">function</span> <span class="identifier">SaveController</span>(<span class="param">$q</span>) {
  <span class="control-flow">this</span>.<span class="identifier">$q</span> <span class="operator">=</span> <span class="identifier">$q</span>;
}

<span class="block-comment">/*
 * return a promise that is resolved based on the user's
 * choice in a dialog box
 */</span>
<span class="identifier">SaveController</span>.<span class="identifier">prototype</span>.<span class="identifier">canDeactivate</span> <span class="operator">=</span> <span class="keyword">function</span>() {
  <span class="control-flow">this</span>.<span class="identifier">deferred</span> <span class="operator">=</span> <span class="control-flow">this</span>.<span class="identifier">$q</span>.<span class="identifier">defer</span>();
  <span class="control-flow">this</span>.<span class="identifier">showSaveDialog</span> <span class="operator">=</span> <span class="boolean">true</span>;
  <span class="control-flow">return</span> <span class="control-flow">this</span>.<span class="identifier">deferred</span>.<span class="identifier">promise</span>();
};
</code></pre>
<pre><code class="lang-html">&lt;div&gt;
  &lt;div ng-show=&quot;showSaveDialog&quot;&gt;
    &lt;p&gt;Would you lke to save your work?&lt;/p&gt;
    &lt;button ng-click=&quot;save.deferred.resolve()&quot;&gt;Save&lt;/button&gt;
    &lt;button ng-click=&quot;save.deferred.reject()&quot;&gt;Discard&lt;/button&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>
<h2 id="deactivate"><a class="anchor" href="#deactivate"><span class="header-link"></span></a>deactivate</h2><p>This hook fires for each component that is removed as part of navigation.</p>
<p>This hook fires after X, but before <code>activate</code>.</p>
<h2 id="-an-example"><a class="anchor" href="#-an-example"><span class="header-link"></span></a>An example</h2><p>In this example, we have a component that prevents navigation until a user saves</p>
<pre><code class="lang-js"><span class="keyword">function</span> <span class="identifier">MyController</span>(<span class="param">user</span>, <span class="param">$http</span>) {
  <span class="control-flow">this</span>.<span class="identifier">user</span> <span class="operator">=</span> <span class="identifier">user</span>;
  <span class="control-flow">this</span>.<span class="identifier">$http</span> <span class="operator">=</span> <span class="identifier">$http</span>;
  <span class="control-flow">this</span>.<span class="identifier">userDataPersisted</span> <span class="operator">=</span> <span class="boolean">true</span>;
}

<span class="identifier">MyController</span>.<span class="identifier">prototype</span>.<span class="identifier">updateUserName</span> <span class="operator">=</span> <span class="keyword">function</span>(<span class="param">newName</span>) {
  <span class="keyword">var</span> <span class="identifier">self</span> <span class="operator">=</span> <span class="control-flow">this</span>;
  <span class="control-flow">this</span>.<span class="identifier">userDataPersisted</span> <span class="operator">=</span> <span class="boolean">false</span>;
  <span class="control-flow">return</span> <span class="control-flow">this</span>.<span class="identifier">user</span>.<span class="identifier">setName</span>(<span class="identifier">newName</span>).<span class="identifier">then</span>(<span class="keyword">function</span> () {
    <span class="identifier">self</span>.<span class="identifier">userDataPersisted</span> <span class="operator">=</span> <span class="boolean">true</span>;
  });
};

<span class="identifier">MyController</span>.<span class="identifier">prototype</span>.<span class="identifier">canActivate</span> <span class="operator">=</span> <span class="keyword">function</span>() {
  <span class="control-flow">return</span> <span class="control-flow">this</span>.<span class="identifier">user</span>.<span class="identifier">isAdmin</span>;
};

<span class="identifier">MyController</span>.<span class="identifier">prototype</span>.<span class="identifier">activate</span> <span class="operator">=</span> <span class="keyword">function</span>() {
  <span class="control-flow">this</span>.<span class="identifier">user</span>.<span class="identifier">downloadBigFiles</span>();
};

<span class="identifier">MyController</span>.<span class="identifier">prototype</span>.<span class="identifier">canDeactivate</span> <span class="operator">=</span> <span class="keyword">function</span>() {
  <span class="control-flow">return</span> <span class="control-flow">this</span>.<span class="identifier">userDataPersisted</span>;
};
</code></pre>
<h2 id="-overview"><a class="anchor" href="#-overview"><span class="header-link"></span></a>Overview</h2><p>This is the basic logic that the router uses when determining whether or not to perform a navigation.</p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: G Pages: 1 -->
<svg width="476pt" height="521pt"
 viewBox="0.00 0.00 476.00 521.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 517)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-517 472,-517 472,4 -4,4"/>
<!-- complete navigation -->
<g id="node1" class="node"><title>complete navigation</title>
<polygon fill="#e5e5e5" stroke="none" points="468,-36 252,-36 252,-0 468,-0 468,-36"/>
<text text-anchor="middle" x="360" y="-14.4" font-family="Helvetica,sans-Serif" font-size="12.00">complete navigation</text>
</g>
<!-- cancel navigation -->
<g id="node2" class="node"><title>cancel navigation</title>
<polygon fill="#e5e5e5" stroke="none" points="216,-36 0,-36 0,-0 216,-0 216,-36"/>
<text text-anchor="middle" x="108" y="-14.4" font-family="Helvetica,sans-Serif" font-size="12.00">cancel navigation</text>
</g>
<!-- begin navigation -->
<g id="node3" class="node"><title>begin navigation</title>
<polygon fill="#e5e5e5" stroke="none" points="468,-513 252,-513 252,-477 468,-477 468,-513"/>
<text text-anchor="middle" x="360" y="-491.4" font-family="Helvetica,sans-Serif" font-size="12.00">begin navigation</text>
</g>
<!-- oldCtrl.canDeactivate() -->
<g id="node4" class="node"><title>oldCtrl.canDeactivate()</title>
<polygon fill="none" stroke="black" points="468,-440 252,-440 252,-404 468,-404 468,-440"/>
<text text-anchor="middle" x="360" y="-418.4" font-family="Courier,monospace" font-size="12.00">oldCtrl.canDeactivate()</text>
</g>
<!-- begin navigation&#45;&gt;oldCtrl.canDeactivate() -->
<g id="edge1" class="edge"><title>begin navigation&#45;&gt;oldCtrl.canDeactivate()</title>
<path fill="none" stroke="black" d="M360,-476.955C360,-476.955 360,-450.09 360,-450.09"/>
<polygon fill="black" stroke="black" points="363.5,-450.09 360,-440.09 356.5,-450.09 363.5,-450.09"/>
</g>
<!-- oldCtrl.canDeactivate()&#45;&gt;cancel navigation -->
<g id="edge3" class="edge"><title>oldCtrl.canDeactivate()&#45;&gt;cancel navigation</title>
<path fill="none" stroke="black" d="M251.662,-422C157.473,-422 36,-422 36,-422 36,-422 36,-46.1439 36,-46.1439"/>
<polygon fill="black" stroke="black" points="39.5001,-46.1439 36,-36.1439 32.5001,-46.1439 39.5001,-46.1439"/>
</g>
<!-- newCtrl = new Ctrl() -->
<g id="node5" class="node"><title>newCtrl = new Ctrl()</title>
<polygon fill="none" stroke="black" points="468,-354 252,-354 252,-318 468,-318 468,-354"/>
<text text-anchor="middle" x="360" y="-332.4" font-family="Courier,monospace" font-size="12.00">newCtrl = new Ctrl()</text>
</g>
<!-- oldCtrl.canDeactivate()&#45;&gt;newCtrl = new Ctrl() -->
<g id="edge2" class="edge"><title>oldCtrl.canDeactivate()&#45;&gt;newCtrl = new Ctrl()</title>
<path fill="none" stroke="black" d="M360,-403.762C360,-403.762 360,-364.212 360,-364.212"/>
<polygon fill="black" stroke="black" points="363.5,-364.212 360,-354.212 356.5,-364.212 363.5,-364.212"/>
<text text-anchor="middle" x="370.883" y="-374.8" font-family="Times,serif" font-size="14.00" fill="darkgreen">true</text>
</g>
<!-- newCtrl = new Ctrl()&#45;&gt;cancel navigation -->
<g id="edge5" class="edge"><title>newCtrl = new Ctrl()&#45;&gt;cancel navigation</title>
<path fill="none" stroke="black" d="M251.94,-336C170.219,-336 72,-336 72,-336 72,-336 72,-46.0082 72,-46.0082"/>
<polygon fill="black" stroke="black" points="75.5001,-46.0082 72,-36.0082 68.5001,-46.0082 75.5001,-46.0082"/>
</g>
<!-- newCtrl.canActivate() -->
<g id="node6" class="node"><title>newCtrl.canActivate()</title>
<polygon fill="none" stroke="black" points="468,-268 252,-268 252,-232 468,-232 468,-268"/>
<text text-anchor="middle" x="360" y="-246.4" font-family="Courier,monospace" font-size="12.00">newCtrl.canActivate()</text>
</g>
<!-- newCtrl = new Ctrl()&#45;&gt;newCtrl.canActivate() -->
<g id="edge4" class="edge"><title>newCtrl = new Ctrl()&#45;&gt;newCtrl.canActivate()</title>
<path fill="none" stroke="black" d="M360,-317.762C360,-317.762 360,-278.212 360,-278.212"/>
<polygon fill="black" stroke="black" points="363.5,-278.212 360,-268.212 356.5,-278.212 363.5,-278.212"/>
<text text-anchor="middle" x="367" y="-288.8" font-family="Times,serif" font-size="14.00" fill="darkgreen">ok</text>
</g>
<!-- newCtrl.canActivate()&#45;&gt;cancel navigation -->
<g id="edge7" class="edge"><title>newCtrl.canActivate()&#45;&gt;cancel navigation</title>
<path fill="none" stroke="black" d="M251.667,-250C183.366,-250 108,-250 108,-250 108,-250 108,-46.2047 108,-46.2047"/>
<polygon fill="black" stroke="black" points="111.5,-46.2046 108,-36.2047 104.5,-46.2047 111.5,-46.2046"/>
</g>
<!-- oldCtrl.deactivate() -->
<g id="node7" class="node"><title>oldCtrl.deactivate()</title>
<polygon fill="none" stroke="black" points="468,-182 252,-182 252,-146 468,-146 468,-182"/>
<text text-anchor="middle" x="360" y="-160.4" font-family="Courier,monospace" font-size="12.00">oldCtrl.deactivate()</text>
</g>
<!-- newCtrl.canActivate()&#45;&gt;oldCtrl.deactivate() -->
<g id="edge6" class="edge"><title>newCtrl.canActivate()&#45;&gt;oldCtrl.deactivate()</title>
<path fill="none" stroke="black" d="M360,-231.762C360,-231.762 360,-192.212 360,-192.212"/>
<polygon fill="black" stroke="black" points="363.5,-192.212 360,-182.212 356.5,-192.212 363.5,-192.212"/>
<text text-anchor="middle" x="370.883" y="-202.8" font-family="Times,serif" font-size="14.00" fill="darkgreen">true</text>
</g>
<!-- oldCtrl.deactivate()&#45;&gt;cancel navigation -->
<g id="edge9" class="edge"><title>oldCtrl.deactivate()&#45;&gt;cancel navigation</title>
<path fill="none" stroke="black" d="M251.684,-164C197.789,-164 144,-164 144,-164 144,-164 144,-46.1958 144,-46.1958"/>
<polygon fill="black" stroke="black" points="147.5,-46.1958 144,-36.1958 140.5,-46.1958 147.5,-46.1958"/>
</g>
<!-- newCtrl.activate() -->
<g id="node8" class="node"><title>newCtrl.activate()</title>
<polygon fill="none" stroke="black" points="468,-109 252,-109 252,-73 468,-73 468,-109"/>
<text text-anchor="middle" x="360" y="-87.4" font-family="Courier,monospace" font-size="12.00">newCtrl.activate()</text>
</g>
<!-- oldCtrl.deactivate()&#45;&gt;newCtrl.activate() -->
<g id="edge8" class="edge"><title>oldCtrl.deactivate()&#45;&gt;newCtrl.activate()</title>
<path fill="none" stroke="black" d="M360,-145.955C360,-145.955 360,-119.09 360,-119.09"/>
<polygon fill="black" stroke="black" points="363.5,-119.09 360,-109.09 356.5,-119.09 363.5,-119.09"/>
</g>
<!-- newCtrl.activate()&#45;&gt;complete navigation -->
<g id="edge10" class="edge"><title>newCtrl.activate()&#45;&gt;complete navigation</title>
<path fill="none" stroke="black" d="M360,-72.9551C360,-72.9551 360,-46.0904 360,-46.0904"/>
<polygon fill="black" stroke="black" points="363.5,-46.0903 360,-36.0904 356.5,-46.0904 363.5,-46.0903"/>
</g>
<!-- newCtrl.activate()&#45;&gt;cancel navigation -->
<g id="edge11" class="edge"><title>newCtrl.activate()&#45;&gt;cancel navigation</title>
<path fill="none" stroke="black" d="M251.917,-91C213.688,-91 180,-91 180,-91 180,-91 180,-46.0449 180,-46.0449"/>
<polygon fill="black" stroke="black" points="183.5,-46.0449 180,-36.0449 176.5,-46.045 183.5,-46.0449"/>
</g>
</g>
</svg>
<h2 id="-handling-failure"><a class="anchor" href="#-handling-failure"><span class="header-link"></span></a>Handling failure</h2><p>What happens when a <code>canActivate</code> or <code>canDeactivate</code> returns <code>false</code>?</p>
<p>By default, this stops the navigation entirely.</p>
<!--
TODO: show multiple levels
TODO:
-->


<!--
## Hooks in Multiple levels
TODO: show multi-level
-->


</body>
</html>
